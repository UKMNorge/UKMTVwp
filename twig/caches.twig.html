<!DOCTYPE html>
<html>
	<head>
		<title>Caches :: UKM-TV</title>
		<link rel="stylesheet" href="//<?= UKM_HOSTNAME ?>/wp-content/themes/UKMresponsive/vendor/bootstrap/3.0.1/css/bootstrap.css">
		<meta http-equiv="refresh" content="30">
	</head>

	<body>
		<div class="UKMwidth">
			<h1>Cacher</h1>
			<p class="lead">Oversikt over alle registrerte cacher som avlaster video.ukm.no</p>
			<p>
				Alle cacher rapporterer selv inn status.
				<br />
				UKM-TV sender ikke brukere til deaktiverte cacher, eller cacher med annen status enn OK.
				<br />
				Cachen selv vil ikke vite noe om den er deaktivert, og opererer som normalt hvis den får henvendelser 
				(noe den etter en tid som deaktivert ikke skal få). 
				<br />
				Merk at pga caching i nettlesere og CloudFlare må det påberegnes noe tid fra en cache deaktiveres og til den ikke lengre får forespørsler.
			</p>
			
			<table class="table table-striped">
			    <tr>
				    <th class="col-xs-1">ID</th>
				    <th class="col-xs-3">IP</th>
				    <th class="col-xs-5">Status</th>
				    <th class="col-xs-3">Siste heartbeat</th>
				</tr>
			
			{% for cache in caches %}
				<tr {{ cache.deactivated ? 'class="alert-danger"' : ''}}>
					<td>{{ cache.id }}</td>
					<td>{{ cache.ip }}</td>
					<td>{{ cache.status }} {{ cache.deactivated ? '<small class="label label-danger">deaktivert</small>' : ''}}</td>
					<td>{{ cache.last_heartbeat }}</td>
					<td>
						{% if cache.deactivated %}
							<a href="?page=UKMTVwp_network_caches&activate={{ cache.id }}" class="btn btn-xs btn-success">Aktiver cache</a>
						{% else %}
							<a href="?page=UKMTVwp_network_caches&deactivate={{ cache.id }}" class="btn btn-xs btn-danger">Deaktiver cache</a>						
						{% endif %}
					</td>
				</tr>
			{% endfor %}
			</table>
		</div>
	</body>
</html>